"use client";

import { useState } from "react";
import {
  Box,
  TextField,
  Button,
  Typography,
  Dialog,
  DialogContent,
  IconButton,
  Autocomplete,
} from "@mui/material";
import { CalendarToday, Close } from "@mui/icons-material";
import { styled } from "@mui/material/styles";
import { LocalizationProvider } from "@mui/x-date-pickers/LocalizationProvider";
import { AdapterDayjs } from "@mui/x-date-pickers/AdapterDayjs";
import { MobileDatePicker } from "@mui/x-date-pickers/MobileDatePicker";
import dayjs from "dayjs";
import { blogPosts } from "../../data/blogs";

const FormContainer = styled(Box)(({ theme }) => ({
  position: "fixed",
  top: 0,
  left: 0,
  width: "100%",
  height: "100%",
  backgroundColor: "rgba(0, 0, 0, 0.8)",
  display: "flex",
  alignItems: "center",
  justifyContent: "center",
  zIndex: 1300,
}));

const FormBox = styled(Box)(({ theme }) => ({
  position: "relative",
  backgroundColor: theme.palette.background.paper,
  padding: theme.spacing(4),
  borderRadius: theme.spacing(2),
  maxWidth: 600,
  width: "95%",
  display: "flex",
  flexDirection: "column",
  gap: theme.spacing(2),
  [theme.breakpoints.down("sm")]: {
    padding: theme.spacing(3),
    maxWidth: "90%",
  },
}));

export default function UserForm({ onComplete, onClose, isOpen = true }) {
  const [formData, setFormData] = useState({
    name: "",
    phone: "",
    email: "",
    dob: "",
    country: "",
  });
  const [showPopup, setShowPopup] = useState(false);
  const [age, setAge] = useState("");
  const [dobError, setDobError] = useState("");
  const [phoneError, setPhoneError] = useState("");
  const [countdown, setCountdown] = useState(10);

  const countries = {
    AD: { name: "Andorra", code: "+376", length: 6, flag: "ğŸ‡¦ğŸ‡©" },
    AE: { name: "UAE", code: "+971", length: 9, flag: "ğŸ‡¦ğŸ‡ª" },
    AF: { name: "Afghanistan", code: "+93", length: 9, flag: "ğŸ‡¦ğŸ‡«" },
    AG: { name: "Antigua and Barbuda", code: "+1", length: 10, flag: "ğŸ‡¦ğŸ‡¬" },
    AI: { name: "Anguilla", code: "+1", length: 10, flag: "ğŸ‡¦ğŸ‡®" },
    AL: { name: "Albania", code: "+355", length: 9, flag: "ğŸ‡¦ğŸ‡±" },
    AM: { name: "Armenia", code: "+374", length: 8, flag: "ğŸ‡¦ğŸ‡²" },
    AO: { name: "Angola", code: "+244", length: 9, flag: "ğŸ‡¦ğŸ‡´" },
    AR: { name: "Argentina", code: "+54", length: 10, flag: "ğŸ‡¦ğŸ‡·" },
    AS: { name: "American Samoa", code: "+1", length: 10, flag: "ğŸ‡¦ğŸ‡¸" },
    AT: { name: "Austria", code: "+43", length: 11, flag: "ğŸ‡¦ğŸ‡¹" },
    AU: { name: "Australia", code: "+61", length: 9, flag: "ğŸ‡¦ğŸ‡º" },
    AW: { name: "Aruba", code: "+297", length: 7, flag: "ğŸ‡¦ğŸ‡¼" },
    AZ: { name: "Azerbaijan", code: "+994", length: 9, flag: "ğŸ‡¦ğŸ‡¿" },
    BA: { name: "Bosnia and Herzegovina", code: "+387", length: 8, flag: "ğŸ‡§ğŸ‡¦" },
    BB: { name: "Barbados", code: "+1", length: 10, flag: "ğŸ‡§ğŸ‡§" },
    BD: { name: "Bangladesh", code: "+880", length: 10, flag: "ğŸ‡§ğŸ‡©" },
    BE: { name: "Belgium", code: "+32", length: 9, flag: "ğŸ‡§ğŸ‡ª" },
    BF: { name: "Burkina Faso", code: "+226", length: 8, flag: "ğŸ‡§ğŸ‡«" },
    BG: { name: "Bulgaria", code: "+359", length: 9, flag: "ğŸ‡§ğŸ‡¬" },
    BH: { name: "Bahrain", code: "+973", length: 8, flag: "ğŸ‡§ğŸ‡­" },
    BI: { name: "Burundi", code: "+257", length: 8, flag: "ğŸ‡§ğŸ‡®" },
    BJ: { name: "Benin", code: "+229", length: 8, flag: "ğŸ‡§ğŸ‡¯" },
    BM: { name: "Bermuda", code: "+1", length: 10, flag: "ğŸ‡§ğŸ‡²" },
    BN: { name: "Brunei", code: "+673", length: 7, flag: "ğŸ‡§ğŸ‡³" },
    BO: { name: "Bolivia", code: "+591", length: 8, flag: "ğŸ‡§ğŸ‡´" },
    BR: { name: "Brazil", code: "+55", length: 11, flag: "ğŸ‡§ğŸ‡·" },
    BS: { name: "Bahamas", code: "+1", length: 10, flag: "ğŸ‡§ğŸ‡¸" },
    BT: { name: "Bhutan", code: "+975", length: 8, flag: "ğŸ‡§ğŸ‡¹" },
    BW: { name: "Botswana", code: "+267", length: 8, flag: "ğŸ‡§ğŸ‡¼" },
    BY: { name: "Belarus", code: "+375", length: 9, flag: "ğŸ‡§ğŸ‡¾" },
    BZ: { name: "Belize", code: "+501", length: 7, flag: "ğŸ‡§ğŸ‡¿" },
    CA: { name: "Canada", code: "+1", length: 10, flag: "ğŸ‡¨ğŸ‡¦" },
    CD: { name: "DR Congo", code: "+243", length: 9, flag: "ğŸ‡¨ğŸ‡©" },
    CF: {
      name: "Central African Republic",
      code: "+236",
      length: 8,
      flag: "ğŸ‡¨ğŸ‡«",
    },
    CG: { name: "Congo", code: "+242", length: 9, flag: "ğŸ‡¨ğŸ‡¬" },
    CH: { name: "Switzerland", code: "+41", length: 9, flag: "ğŸ‡¨ğŸ‡­" },
    CI: { name: "Ivory Coast", code: "+225", length: 10, flag: "ğŸ‡¨ğŸ‡®" },
    CK: { name: "Cook Islands", code: "+682", length: 5, flag: "ğŸ‡¨ğŸ‡°" },
    CL: { name: "Chile", code: "+56", length: 9, flag: "ğŸ‡¨ğŸ‡±" },
    CM: { name: "Cameroon", code: "+237", length: 9, flag: "ğŸ‡¨ğŸ‡²" },
    CN: { name: "China", code: "+86", length: 11, flag: "ğŸ‡¨ğŸ‡³" },
    CO: { name: "Colombia", code: "+57", length: 10, flag: "ğŸ‡¨ğŸ‡´" },
    CR: { name: "Costa Rica", code: "+506", length: 8, flag: "ğŸ‡¨ğŸ‡·" },
    CU: { name: "Cuba", code: "+53", length: 8, flag: "ğŸ‡¨ğŸ‡º" },
    CV: { name: "Cape Verde", code: "+238", length: 7, flag: "ğŸ‡¨ğŸ‡»" },
    CY: { name: "Cyprus", code: "+357", length: 8, flag: "ğŸ‡¨ğŸ‡¾" },
    CZ: { name: "Czech Republic", code: "+420", length: 9, flag: "ğŸ‡¨ğŸ‡¿" },
    DE: { name: "Germany", code: "+49", length: 11, flag: "ğŸ‡©ğŸ‡ª" },
    DJ: { name: "Djibouti", code: "+253", length: 8, flag: "ğŸ‡©ğŸ‡¯" },
    DK: { name: "Denmark", code: "+45", length: 8, flag: "ğŸ‡©ğŸ‡°" },
    DM: { name: "Dominica", code: "+1", length: 10, flag: "ğŸ‡©ğŸ‡²" },
    DO: { name: "Dominican Republic", code: "+1", length: 10, flag: "ğŸ‡©ğŸ‡´" },
    DZ: { name: "Algeria", code: "+213", length: 9, flag: "ğŸ‡©ğŸ‡¿" },
    EC: { name: "Ecuador", code: "+593", length: 9, flag: "ğŸ‡ªğŸ‡¨" },
    EE: { name: "Estonia", code: "+372", length: 8, flag: "ğŸ‡ªğŸ‡ª" },
    EG: { name: "Egypt", code: "+20", length: 10, flag: "ğŸ‡ªğŸ‡¬" },
    ER: { name: "Eritrea", code: "+291", length: 7, flag: "ğŸ‡ªğŸ‡·" },
    ES: { name: "Spain", code: "+34", length: 9, flag: "ğŸ‡ªğŸ‡¸" },
    ET: { name: "Ethiopia", code: "+251", length: 9, flag: "ğŸ‡ªğŸ‡¹" },
    FI: { name: "Finland", code: "+358", length: 10, flag: "ğŸ‡«ğŸ‡®" },
    FJ: { name: "Fiji", code: "+679", length: 7, flag: "ğŸ‡«ğŸ‡¯" },
    FK: { name: "Falkland Islands", code: "+500", length: 5, flag: "ğŸ‡«ğŸ‡°" },
    FM: { name: "Micronesia", code: "+691", length: 7, flag: "ğŸ‡«ğŸ‡²" },
    FO: { name: "Faroe Islands", code: "+298", length: 6, flag: "ğŸ‡«ğŸ‡´" },
    FR: { name: "France", code: "+33", length: 10, flag: "ğŸ‡«ğŸ‡·" },
    GA: { name: "Gabon", code: "+241", length: 8, flag: "ğŸ‡¬ğŸ‡¦" },
    GB: { name: "UK", code: "+44", length: 10, flag: "ğŸ‡¬ğŸ‡§" },
    GD: { name: "Grenada", code: "+1", length: 10, flag: "ğŸ‡¬ğŸ‡©" },
    GE: { name: "Georgia", code: "+995", length: 9, flag: "ğŸ‡¬ğŸ‡ª" },
    GF: { name: "French Guiana", code: "+594", length: 9, flag: "ğŸ‡¬ğŸ‡«" },
    GH: { name: "Ghana", code: "+233", length: 9, flag: "ğŸ‡¬ğŸ‡­" },
    GI: { name: "Gibraltar", code: "+350", length: 8, flag: "ğŸ‡¬ğŸ‡®" },
    GL: { name: "Greenland", code: "+299", length: 6, flag: "ğŸ‡¬ğŸ‡±" },
    GM: { name: "Gambia", code: "+220", length: 7, flag: "ğŸ‡¬ğŸ‡²" },
    GN: { name: "Guinea", code: "+224", length: 9, flag: "ğŸ‡¬ğŸ‡³" },
    GP: { name: "Guadeloupe", code: "+590", length: 9, flag: "ğŸ‡¬ğŸ‡µ" },
    GQ: { name: "Equatorial Guinea", code: "+240", length: 9, flag: "ğŸ‡¬ğŸ‡¶" },
    GR: { name: "Greece", code: "+30", length: 10, flag: "ğŸ‡¬ğŸ‡·" },
    GT: { name: "Guatemala", code: "+502", length: 8, flag: "ğŸ‡¬ğŸ‡¹" },
    GU: { name: "Guam", code: "+1", length: 10, flag: "ğŸ‡¬ğŸ‡º" },
    GW: { name: "Guinea-Bissau", code: "+245", length: 7, flag: "ğŸ‡¬ğŸ‡¼" },
    GY: { name: "Guyana", code: "+592", length: 7, flag: "ğŸ‡¬ğŸ‡¾" },
    HK: { name: "Hong Kong", code: "+852", length: 8, flag: "ğŸ‡­ğŸ‡°" },
    HN: { name: "Honduras", code: "+504", length: 8, flag: "ğŸ‡­ğŸ‡³" },
    HR: { name: "Croatia", code: "+385", length: 9, flag: "ğŸ‡­ğŸ‡·" },
    HT: { name: "Haiti", code: "+509", length: 8, flag: "ğŸ‡­ğŸ‡¹" },
    HU: { name: "Hungary", code: "+36", length: 9, flag: "ğŸ‡­ğŸ‡º" },
    ID: { name: "Indonesia", code: "+62", length: 11, flag: "ğŸ‡®ğŸ‡©" },
    IE: { name: "Ireland", code: "+353", length: 9, flag: "ğŸ‡®ğŸ‡ª" },
    IL: { name: "Israel", code: "+972", length: 9, flag: "ğŸ‡®ğŸ‡±" },
    IM: { name: "Isle of Man", code: "+44", length: 10, flag: "ğŸ‡®ğŸ‡²" },
    IN: { name: "India", code: "+91", length: 10, flag: "ğŸ‡®ğŸ‡³" },
    IO: {
      name: "British Indian Ocean Territory",
      code: "+246",
      length: 7,
      flag: "ğŸ‡®ğŸ‡´",
    },
    IQ: { name: "Iraq", code: "+964", length: 10, flag: "ğŸ‡®ğŸ‡¶" },
    IR: { name: "Iran", code: "+98", length: 10, flag: "ğŸ‡®ğŸ‡·" },
    IS: { name: "Iceland", code: "+354", length: 7, flag: "ğŸ‡®ğŸ‡¸" },
    IT: { name: "Italy", code: "+39", length: 10, flag: "ğŸ‡®ğŸ‡¹" },
    JE: { name: "Jersey", code: "+44", length: 10, flag: "ğŸ‡¯ğŸ‡ª" },
    JM: { name: "Jamaica", code: "+1", length: 10, flag: "ğŸ‡¯ğŸ‡²" },
    JO: { name: "Jordan", code: "+962", length: 9, flag: "ğŸ‡¯ğŸ‡´" },
    JP: { name: "Japan", code: "+81", length: 11, flag: "ğŸ‡¯ğŸ‡µ" },
    KE: { name: "Kenya", code: "+254", length: 9, flag: "ğŸ‡°ğŸ‡ª" },
    KG: { name: "Kyrgyzstan", code: "+996", length: 9, flag: "ğŸ‡°ğŸ‡¬" },
    KH: { name: "Cambodia", code: "+855", length: 9, flag: "ğŸ‡°ğŸ‡­" },
    KI: { name: "Kiribati", code: "+686", length: 8, flag: "ğŸ‡°ğŸ‡®" },
    KM: { name: "Comoros", code: "+269", length: 7, flag: "ğŸ‡°ğŸ‡²" },
    KN: { name: "Saint Kitts and Nevis", code: "+1", length: 10, flag: "ğŸ‡°ğŸ‡³" },
    KP: { name: "North Korea", code: "+850", length: 10, flag: "ğŸ‡°ğŸ‡µ" },
    KR: { name: "South Korea", code: "+82", length: 11, flag: "ğŸ‡°ğŸ‡·" },
    KW: { name: "Kuwait", code: "+965", length: 8, flag: "ğŸ‡°ğŸ‡¼" },
    KY: { name: "Cayman Islands", code: "+1", length: 10, flag: "ğŸ‡°ğŸ‡¾" },
    KZ: { name: "Kazakhstan", code: "+7", length: 10, flag: "ğŸ‡°ğŸ‡¿" },
    LA: { name: "Laos", code: "+856", length: 10, flag: "ğŸ‡±ğŸ‡¦" },
    LB: { name: "Lebanon", code: "+961", length: 8, flag: "ğŸ‡±ğŸ‡§" },
    LC: { name: "Saint Lucia", code: "+1", length: 10, flag: "ğŸ‡±ğŸ‡¨" },
    LI: { name: "Liechtenstein", code: "+423", length: 7, flag: "ğŸ‡±ğŸ‡®" },
    LK: { name: "Sri Lanka", code: "+94", length: 9, flag: "ğŸ‡±ğŸ‡°" },
    LR: { name: "Liberia", code: "+231", length: 8, flag: "ğŸ‡±ğŸ‡·" },
    LS: { name: "Lesotho", code: "+266", length: 8, flag: "ğŸ‡±ğŸ‡¸" },
    LT: { name: "Lithuania", code: "+370", length: 8, flag: "ğŸ‡±ğŸ‡¹" },
    LU: { name: "Luxembourg", code: "+352", length: 9, flag: "ğŸ‡±ğŸ‡º" },
    LV: { name: "Latvia", code: "+371", length: 8, flag: "ğŸ‡±ğŸ‡»" },
    LY: { name: "Libya", code: "+218", length: 9, flag: "ğŸ‡±ğŸ‡¾" },
    MA: { name: "Morocco", code: "+212", length: 9, flag: "ğŸ‡²ğŸ‡¦" },
    MC: { name: "Monaco", code: "+377", length: 8, flag: "ğŸ‡²ğŸ‡¨" },
    MD: { name: "Moldova", code: "+373", length: 8, flag: "ğŸ‡²ğŸ‡©" },
    ME: { name: "Montenegro", code: "+382", length: 8, flag: "ğŸ‡²ğŸ‡ª" },
    MF: { name: "Saint Martin", code: "+590", length: 9, flag: "ğŸ‡²ğŸ‡«" },
    MG: { name: "Madagascar", code: "+261", length: 9, flag: "ğŸ‡²ğŸ‡¬" },
    MH: { name: "Marshall Islands", code: "+692", length: 7, flag: "ğŸ‡²ğŸ‡­" },
    MK: { name: "North Macedonia", code: "+389", length: 8, flag: "ğŸ‡²ğŸ‡°" },
    ML: { name: "Mali", code: "+223", length: 8, flag: "ğŸ‡²ğŸ‡±" },
    MM: { name: "Myanmar", code: "+95", length: 9, flag: "ğŸ‡²ğŸ‡²" },
    MN: { name: "Mongolia", code: "+976", length: 8, flag: "ğŸ‡²ğŸ‡³" },
    MO: { name: "Macau", code: "+853", length: 8, flag: "ğŸ‡²ğŸ‡´" },
    MP: {
      name: "Northern Mariana Islands",
      code: "+1",
      length: 10,
      flag: "ğŸ‡²ğŸ‡µ",
    },
    MQ: { name: "Martinique", code: "+596", length: 9, flag: "ğŸ‡²ğŸ‡¶" },
    MR: { name: "Mauritania", code: "+222", length: 8, flag: "ğŸ‡²ğŸ‡·" },
    MS: { name: "Montserrat", code: "+1", length: 10, flag: "ğŸ‡²ğŸ‡¸" },
    MT: { name: "Malta", code: "+356", length: 8, flag: "ğŸ‡²ğŸ‡¹" },
    MU: { name: "Mauritius", code: "+230", length: 8, flag: "ğŸ‡²ğŸ‡º" },
    MV: { name: "Maldives", code: "+960", length: 7, flag: "ğŸ‡²ğŸ‡»" },
    MW: { name: "Malawi", code: "+265", length: 9, flag: "ğŸ‡²ğŸ‡¼" },
    MX: { name: "Mexico", code: "+52", length: 10, flag: "ğŸ‡²ğŸ‡½" },
    MY: { name: "Malaysia", code: "+60", length: 10, flag: "ğŸ‡²ğŸ‡¾" },
    MZ: { name: "Mozambique", code: "+258", length: 9, flag: "ğŸ‡²ğŸ‡¿" },
    NA: { name: "Namibia", code: "+264", length: 9, flag: "ğŸ‡³ğŸ‡¦" },
    NC: { name: "New Caledonia", code: "+687", length: 6, flag: "ğŸ‡³ğŸ‡¨" },
    NE: { name: "Niger", code: "+227", length: 8, flag: "ğŸ‡³ğŸ‡ª" },
    NF: { name: "Norfolk Island", code: "+672", length: 6, flag: "ğŸ‡³ğŸ‡«" },
    NG: { name: "Nigeria", code: "+234", length: 10, flag: "ğŸ‡³ğŸ‡¬" },
    NI: { name: "Nicaragua", code: "+505", length: 8, flag: "ğŸ‡³ğŸ‡®" },
    NL: { name: "Netherlands", code: "+31", length: 9, flag: "ğŸ‡³ğŸ‡±" },
    NO: { name: "Norway", code: "+47", length: 8, flag: "ğŸ‡³ğŸ‡´" },
    NP: { name: "Nepal", code: "+977", length: 10, flag: "ğŸ‡³ğŸ‡µ" },
    NR: { name: "Nauru", code: "+674", length: 7, flag: "ğŸ‡³ğŸ‡·" },
    NU: { name: "Niue", code: "+683", length: 4, flag: "ğŸ‡³ğŸ‡º" },
    NZ: { name: "New Zealand", code: "+64", length: 9, flag: "ğŸ‡³ğŸ‡¿" },
    OM: { name: "Oman", code: "+968", length: 8, flag: "ğŸ‡´ğŸ‡²" },
    PA: { name: "Panama", code: "+507", length: 8, flag: "ğŸ‡µğŸ‡¦" },
    PE: { name: "Peru", code: "+51", length: 9, flag: "ğŸ‡µğŸ‡ª" },
    PF: { name: "French Polynesia", code: "+689", length: 8, flag: "ğŸ‡µğŸ‡«" },
    PG: { name: "Papua New Guinea", code: "+675", length: 8, flag: "ğŸ‡µğŸ‡¬" },
    PH: { name: "Philippines", code: "+63", length: 10, flag: "ğŸ‡µğŸ‡­" },
    PL: { name: "Poland", code: "+48", length: 9, flag: "ğŸ‡µğŸ‡±" },
    PM: {
      name: "Saint Pierre and Miquelon",
      code: "+508",
      length: 6,
      flag: "ğŸ‡µğŸ‡²",
    },
    PR: { name: "Puerto Rico", code: "+1", length: 10, flag: "ğŸ‡µğŸ‡·" },
    PS: { name: "Palestine", code: "+970", length: 9, flag: "ğŸ‡µğŸ‡¸" },
    PT: { name: "Portugal", code: "+351", length: 9, flag: "ğŸ‡µğŸ‡¹" },
    PW: { name: "Palau", code: "+680", length: 7, flag: "ğŸ‡µğŸ‡¼" },
    PY: { name: "Paraguay", code: "+595", length: 9, flag: "ğŸ‡µğŸ‡¾" },
    QA: { name: "Qatar", code: "+974", length: 8, flag: "ğŸ‡¶ğŸ‡¦" },
    RE: { name: "RÃ©union", code: "+262", length: 9, flag: "ğŸ‡·ğŸ‡ª" },
    RO: { name: "Romania", code: "+40", length: 9, flag: "ğŸ‡·ğŸ‡´" },
    RS: { name: "Serbia", code: "+381", length: 9, flag: "ğŸ‡·ğŸ‡¸" },
    RU: { name: "Russia", code: "+7", length: 10, flag: "ğŸ‡·ğŸ‡º" },
    RW: { name: "Rwanda", code: "+250", length: 9, flag: "ğŸ‡·ğŸ‡¼" },
    SA: { name: "Saudi Arabia", code: "+966", length: 9, flag: "ğŸ‡¸ğŸ‡¦" },
    SB: { name: "Solomon Islands", code: "+677", length: 7, flag: "ğŸ‡¸ğŸ‡§" },
    SC: { name: "Seychelles", code: "+248", length: 7, flag: "ğŸ‡¸ğŸ‡¨" },
    SD: { name: "Sudan", code: "+249", length: 9, flag: "ğŸ‡¸ğŸ‡©" },
    SE: { name: "Sweden", code: "+46", length: 9, flag: "ğŸ‡¸ğŸ‡ª" },
    SG: { name: "Singapore", code: "+65", length: 8, flag: "ğŸ‡¸ğŸ‡¬" },
    SH: { name: "Saint Helena", code: "+290", length: 4, flag: "ğŸ‡¸ğŸ‡­" },
    SI: { name: "Slovenia", code: "+386", length: 8, flag: "ğŸ‡¸ğŸ‡®" },
    SK: { name: "Slovakia", code: "+421", length: 9, flag: "ğŸ‡¸ğŸ‡°" },
    SL: { name: "Sierra Leone", code: "+232", length: 8, flag: "ğŸ‡¸ğŸ‡±" },
    SM: { name: "San Marino", code: "+378", length: 10, flag: "ğŸ‡¸ğŸ‡²" },
    SN: { name: "Senegal", code: "+221", length: 9, flag: "ğŸ‡¸ğŸ‡³" },
    SO: { name: "Somalia", code: "+252", length: 8, flag: "ğŸ‡¸ğŸ‡´" },
    SR: { name: "Suriname", code: "+597", length: 7, flag: "ğŸ‡¸ğŸ‡·" },
    SS: { name: "South Sudan", code: "+211", length: 9, flag: "ğŸ‡¸ğŸ‡¸" },
    ST: { name: "SÃ£o TomÃ© and PrÃ­ncipe", code: "+239", length: 7, flag: "ğŸ‡¸ğŸ‡¹" },
    SV: { name: "El Salvador", code: "+503", length: 8, flag: "ğŸ‡¸ğŸ‡»" },
    SX: { name: "Sint Maarten", code: "+1", length: 10, flag: "ğŸ‡¸ğŸ‡½" },
    SY: { name: "Syria", code: "+963", length: 9, flag: "ğŸ‡¸ğŸ‡¾" },
    SZ: { name: "Eswatini", code: "+268", length: 8, flag: "ğŸ‡¸ğŸ‡¿" },
    TC: {
      name: "Turks and Caicos Islands",
      code: "+1",
      length: 10,
      flag: "ğŸ‡¹ğŸ‡¨",
    },
    TD: { name: "Chad", code: "+235", length: 8, flag: "ğŸ‡¹ğŸ‡©" },
    TG: { name: "Togo", code: "+228", length: 8, flag: "ğŸ‡¹ğŸ‡¬" },
    TH: { name: "Thailand", code: "+66", length: 9, flag: "ğŸ‡¹ğŸ‡­" },
    TJ: { name: "Tajikistan", code: "+992", length: 9, flag: "ğŸ‡¹ğŸ‡¯" },
    TK: { name: "Tokelau", code: "+690", length: 4, flag: "ğŸ‡¹ğŸ‡°" },
    TL: { name: "East Timor", code: "+670", length: 8, flag: "ğŸ‡¹ğŸ‡±" },
    TM: { name: "Turkmenistan", code: "+993", length: 8, flag: "ğŸ‡¹ğŸ‡²" },
    TN: { name: "Tunisia", code: "+216", length: 8, flag: "ğŸ‡¹ğŸ‡³" },
    TO: { name: "Tonga", code: "+676", length: 5, flag: "ğŸ‡¹ğŸ‡´" },
    TR: { name: "Turkey", code: "+90", length: 10, flag: "ğŸ‡¹ğŸ‡·" },
    TT: { name: "Trinidad and Tobago", code: "+1", length: 10, flag: "ğŸ‡¹ğŸ‡¹" },
    TV: { name: "Tuvalu", code: "+688", length: 5, flag: "ğŸ‡¹ğŸ‡»" },
    TW: { name: "Taiwan", code: "+886", length: 9, flag: "ğŸ‡¹ğŸ‡¼" },
    TZ: { name: "Tanzania", code: "+255", length: 9, flag: "ğŸ‡¹ğŸ‡¿" },
    UA: { name: "Ukraine", code: "+380", length: 9, flag: "ğŸ‡ºğŸ‡¦" },
    UG: { name: "Uganda", code: "+256", length: 9, flag: "ğŸ‡ºğŸ‡¬" },
    US: { name: "USA", code: "+1", length: 10, flag: "ğŸ‡ºğŸ‡¸" },
    UY: { name: "Uruguay", code: "+598", length: 8, flag: "ğŸ‡ºğŸ‡¾" },
    UZ: { name: "Uzbekistan", code: "+998", length: 9, flag: "ğŸ‡ºğŸ‡¿" },
    VA: { name: "Vatican City", code: "+39", length: 10, flag: "ğŸ‡»ğŸ‡¦" },
    VC: {
      name: "Saint Vincent and the Grenadines",
      code: "+1",
      length: 10,
      flag: "ğŸ‡»ğŸ‡¨",
    },
    VE: { name: "Venezuela", code: "+58", length: 10, flag: "ğŸ‡»ğŸ‡ª" },
    VG: { name: "British Virgin Islands", code: "+1", length: 10, flag: "ğŸ‡»ğŸ‡¬" },
    VI: { name: "US Virgin Islands", code: "+1", length: 10, flag: "ğŸ‡»ğŸ‡®" },
    VN: { name: "Vietnam", code: "+84", length: 9, flag: "ğŸ‡»ğŸ‡³" },
    VU: { name: "Vanuatu", code: "+678", length: 7, flag: "ğŸ‡»ğŸ‡º" },
    WF: { name: "Wallis and Futuna", code: "+681", length: 6, flag: "ğŸ‡¼ğŸ‡«" },
    WS: { name: "Samoa", code: "+685", length: 7, flag: "ğŸ‡¼ğŸ‡¸" },
    YE: { name: "Yemen", code: "+967", length: 9, flag: "ğŸ‡¾ğŸ‡ª" },
    YT: { name: "Mayotte", code: "+262", length: 9, flag: "ğŸ‡¾ğŸ‡¹" },
    ZA: { name: "South Africa", code: "+27", length: 9, flag: "ğŸ‡¿ğŸ‡¦" },
    ZM: { name: "Zambia", code: "+260", length: 9, flag: "ğŸ‡¿ğŸ‡²" },
    ZW: { name: "Zimbabwe", code: "+263", length: 9, flag: "ğŸ‡¿ğŸ‡¼" },
  };

  const handleChange = (field) => (event) => {
    let value = event.target.value;

    if (field === "phone" && formData.country && countries[formData.country]) {
      value = value.replace(/\D/g, "");
      const maxLength = countries[formData.country].length;
      if (value.length > maxLength) {
        value = value.substring(0, maxLength);
      }

      if (value.length > 0 && value.length !== maxLength) {
        setPhoneError(`Phone number must be ${maxLength} digits`);
      } else {
        setPhoneError("");
      }
    }

    setFormData((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  const handleCountryChange = (event) => {
    const newCountry = event.target.value;
    setFormData((prev) => ({
      ...prev,
      country: newCountry,
      phone: "",
    }));
    setPhoneError("");
  };

  const handleDateChange = (date) => {
    if (date) {
      const today = dayjs();

      if (date.isAfter(today)) {
        setDobError("Future date is not allowed");
        setAge("");
      } else {
        setDobError("");
        const calculatedAge = today.diff(date, "year");
        setAge(calculatedAge.toString());
      }

      setFormData((prev) => ({
        ...prev,
        dob: date.format("YYYY-MM-DD"),
      }));
    } else {
      setDobError("");
      setAge("");
      setFormData((prev) => ({
        ...prev,
        dob: "",
      }));
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!formData.country || !countries[formData.country]) return;
    const phoneLength = countries[formData.country].length;
    if (
      formData.name &&
      formData.phone &&
      formData.email &&
      formData.dob &&
      !dobError &&
      !phoneError &&
      formData.phone.length === phoneLength
    ) {
      // Log user data to console
      const userData = {
        name: formData.name,
        countryCode: countries[formData.country].code,
        phone: formData.phone,
        email: formData.email,
        dateOfBirth: formData.dob,
        age: age,
        country: countries[formData.country].name,
      };
      console.log("User Registration Data:", userData);

      // Close form and let parent handle popup
      if (onClose) onClose();
      if (onComplete) onComplete();
    }
  };

  return (
    <>
      {isOpen && (
        <FormContainer>
          <FormBox component="form" onSubmit={handleSubmit}>
            <IconButton
              onClick={onClose}
              sx={{ position: "absolute", top: 8, right: 8, color: "grey.600" }}
            >
              <Close />
            </IconButton>
            <Typography variant="h5" textAlign="center" mb={2}>
              Complete Your Registration
            </Typography>

            <TextField
              label="Full Name"
              value={formData.name}
              onChange={handleChange("name")}
              required
              fullWidth
            />

            <Box
              sx={{
                display: "flex",
                gap: 1,
                flexDirection: { xs: "column", sm: "row" },
              }}
            >
              <Autocomplete
                sx={{ minWidth: { xs: "100%", sm: 180 } }}
                options={Object.entries(countries).map(
                  ([countryCode, country]) => ({
                    id: countryCode,
                    code: countryCode,
                    ...country,
                  })
                )}
                value={
                  formData.country
                    ? {
                        id: formData.country,
                        code: formData.country,
                        ...countries[formData.country],
                      }
                    : null
                }
                onChange={(event, newValue) => {
                  const countryCode = newValue ? newValue.id : "";
                  setFormData((prev) => ({
                    ...prev,
                    country: countryCode,
                    phone: "",
                  }));
                  setPhoneError("");
                }}
                getOptionLabel={(option) => option.code || ""}
                isOptionEqualToValue={(option, value) => option.id === value.id}
                renderOption={(props, option) => (
                  <Box component="li" {...props} key={option.id}>
                    <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
                      <span>{option.flag}</span>
                      <span>{option.code}</span>
                    </Box>
                  </Box>
                )}
                renderInput={(params) => {
                  const selectedCountry = formData.country
                    ? countries[formData.country]
                    : null;
                  return (
                    <TextField
                      {...params}
                      label="Country Code"
                      required
                      placeholder="Type to search..."
                      InputProps={{
                        ...params.InputProps,
                        startAdornment: selectedCountry ? (
                          <Box
                            sx={{
                              display: "flex",
                              alignItems: "center",
                              mr: 1,
                            }}
                          >
                            {selectedCountry.flag}
                          </Box>
                        ) : null,
                      }}
                    />
                  );
                }}
                ListboxProps={{
                  style: { zIndex: 1400, maxHeight: 200 },
                }}
              />

              <TextField
                label={
                  formData.country && countries[formData.country]
                    ? `Phone Number (${countries[formData.country].code})`
                    : "Phone Number"
                }
                value={formData.phone}
                onChange={handleChange("phone")}
                required
                fullWidth
                disabled={!formData.country}
                error={!!phoneError}
                helperText={
                  phoneError ||
                  (formData.country && countries[formData.country]
                    ? `Enter ${countries[formData.country].length} digits`
                    : "Select country first")
                }
                inputProps={{
                  maxLength:
                    formData.country && countries[formData.country]
                      ? countries[formData.country].length
                      : 15,
                  pattern: "[0-9]*",
                  inputMode: "numeric",
                }}
              />
            </Box>

            <TextField
              label="Email"
              type="email"
              value={formData.email}
              onChange={handleChange("email")}
              required
              fullWidth
            />

            <Box sx={{ position: "relative", zIndex: 1 }}>
              <LocalizationProvider dateAdapter={AdapterDayjs}>
                <MobileDatePicker
                  label="Date of Birth"
                  value={formData.dob ? dayjs(formData.dob) : null}
                  onChange={handleDateChange}
                  maxDate={dayjs()}
                  format="DD/MM/YYYY"
                  openTo="year"
                  slots={{
                    openPickerIcon: CalendarToday,
                  }}
                  slotProps={{
                    textField: {
                      required: true,
                      fullWidth: true,
                      error: !!dobError,
                      helperText: dobError,
                      InputProps: {
                        readOnly: true,
                      },
                    },
                    dialog: {
                      sx: {
                        zIndex: 1500,
                      },
                    },
                  }}
                />
              </LocalizationProvider>
              {age && (
                <Typography
                  variant="body2"
                  color="text.secondary"
                  sx={{ mt: 1 }}
                >
                  Age: {age} years
                </Typography>
              )}
            </Box>

            <Button
              type="submit"
              variant="contained"
              fullWidth
              size="large"
              disabled={
                !formData.name ||
                !formData.phone ||
                !formData.email ||
                !formData.dob ||
                !!dobError ||
                !!phoneError ||
                (formData.country &&
                  countries[formData.country] &&
                  formData.phone.length !== countries[formData.country].length)
              }
            >
              Submit
            </Button>
          </FormBox>
        </FormContainer>
      )}

      <Dialog open={showPopup} maxWidth="sm" fullWidth>
        <DialogContent sx={{ textAlign: "center", py: 4 }}>
          <Typography variant="h6" color="success.main" gutterBottom>
            âœ… Registration Successful!
          </Typography>
          <Typography variant="body1" gutterBottom>
            Link will be sent to you via mail. Check your mail!
          </Typography>
          <Typography variant="body2" color="text.secondary">
            Redirecting to blogs in {countdown} seconds...
          </Typography>
        </DialogContent>
      </Dialog>
    </>
  );
}
